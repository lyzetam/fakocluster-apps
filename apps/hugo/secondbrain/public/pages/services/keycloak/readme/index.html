<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name"> | My New Hugo Site</title>
<meta property="og:title" content=" | My New Hugo Site" />
<meta name="twitter:title" content=" | My New Hugo Site" />
<meta itemprop="name" content=" | My New Hugo Site" />
<meta name="application-name" content=" | My New Hugo Site" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/pages/services/keycloak/readme/" title="" />






<meta name="generator" content="Hugo 0.148.2">

    
    <meta property="og:url" content="http://localhost:1313/pages/services/keycloak/readme/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="My New Hugo Site">
  <meta property="og:description" content="Keycloak Identity and Access Management Overview Keycloak is an open-source Identity and Access Management (IAM) solution deployed in the Fako cluster. It provides single sign-on (SSO), user federation, identity brokering, and social login capabilities. This deployment uses Keycloak 26.x with PostgreSQL backend and is configured for high availability with clustering.
Key Features Single Sign-On (SSO): One login for multiple applications Identity Brokering: Connect to external identity providers User Federation: Sync users from LDAP or Active Directory Social Login: Support for Google, GitHub, Facebook, etc. Multi-Factor Authentication: Enhanced security with MFA High Availability: Clustered deployment with 2 replicas Secure Credential Management: Integration with AWS Secrets Manager Architecture Components Deployment: 2-replica deployment with pod anti-affinity Services: Main service on port 8080 Headless service for JGroups clustering Storage: PostgreSQL database (postgres-cluster) ConfigMap: Environment configuration External Secrets: Admin credentials from AWS Secrets Manager Database credentials from AWS Secrets Manager Init Container: Database initialization and user setup Resource Requirements Memory: 1Gi (request), 2Gi (limit) per pod CPU: 500m (request), 1000m (limit) per pod Database: PostgreSQL with dedicated database and user Configuration Environment Settings Parameter Value Description KC_HOSTNAME https://auth.landryzetam.net External hostname KC_HOSTNAME_STRICT false Allow backend access KC_HTTP_ENABLED true Enable HTTP (behind proxy) KC_PROXY edge Running behind edge proxy KC_PROXY_HEADERS xforwarded Use X-Forwarded headers KC_HEALTH_ENABLED true Enable health endpoints KC_METRICS_ENABLED true Enable metrics KC_CACHE_STACK kubernetes Use Kubernetes discovery Database Configuration Type: PostgreSQL Host: postgres-cluster-rw.postgres.svc.cluster.local Port: 5432 Database: keycloak Credentials: Managed via AWS Secrets Manager Clustering Configuration JGroups clustering is configured for session replication:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="pages">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="My New Hugo Site">
  <meta name="twitter:description" content="Keycloak Identity and Access Management Overview Keycloak is an open-source Identity and Access Management (IAM) solution deployed in the Fako cluster. It provides single sign-on (SSO), user federation, identity brokering, and social login capabilities. This deployment uses Keycloak 26.x with PostgreSQL backend and is configured for high availability with clustering.
Key Features Single Sign-On (SSO): One login for multiple applications Identity Brokering: Connect to external identity providers User Federation: Sync users from LDAP or Active Directory Social Login: Support for Google, GitHub, Facebook, etc. Multi-Factor Authentication: Enhanced security with MFA High Availability: Clustered deployment with 2 replicas Secure Credential Management: Integration with AWS Secrets Manager Architecture Components Deployment: 2-replica deployment with pod anti-affinity Services: Main service on port 8080 Headless service for JGroups clustering Storage: PostgreSQL database (postgres-cluster) ConfigMap: Environment configuration External Secrets: Admin credentials from AWS Secrets Manager Database credentials from AWS Secrets Manager Init Container: Database initialization and user setup Resource Requirements Memory: 1Gi (request), 2Gi (limit) per pod CPU: 500m (request), 1000m (limit) per pod Database: PostgreSQL with dedicated database and user Configuration Environment Settings Parameter Value Description KC_HOSTNAME https://auth.landryzetam.net External hostname KC_HOSTNAME_STRICT false Allow backend access KC_HTTP_ENABLED true Enable HTTP (behind proxy) KC_PROXY edge Running behind edge proxy KC_PROXY_HEADERS xforwarded Use X-Forwarded headers KC_HEALTH_ENABLED true Enable health endpoints KC_METRICS_ENABLED true Enable metrics KC_CACHE_STACK kubernetes Use Kubernetes discovery Database Configuration Type: PostgreSQL Host: postgres-cluster-rw.postgres.svc.cluster.local Port: 5432 Database: keycloak Credentials: Managed via AWS Secrets Manager Clustering Configuration JGroups clustering is configured for session replication:">


    

    <link rel="canonical" href="http://localhost:1313/pages/services/keycloak/readme/">
    <link href="/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        About
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/projects/">
                        Projects
                    </a>
                    
                    <ul>
                        
                        <li>
                            <a class="menu-link "
                                href="/pages/projects/ollama/">
                                Ollama AI Server
                            </a>
                        </li>
                        
                        <li>
                            <a class="menu-link "
                                href="/pages/projects/open-webui/">
                                Open WebUI
                            </a>
                        </li>
                        
                        <li>
                            <a class="menu-link "
                                href="/pages/projects/n8n/">
                                N8N Automation
                            </a>
                        </li>
                        
                        <li>
                            <a class="menu-link "
                                href="/pages/projects/oura-dashboard/">
                                Oura Dashboard
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="">
                        Architecture
                    </a>
                    
                    <ul>
                        
                        <li>
                            <a class="menu-link "
                                href="/pages/architecture/overview/">
                                Overview
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title"></h1>
                
                
            </header>
            
            <div class="page-content">
                <h1 id="keycloak-identity-and-access-management">Keycloak Identity and Access Management</h1>
<h2 id="overview">Overview</h2>
<p>Keycloak is an open-source Identity and Access Management (IAM) solution deployed in the Fako cluster. It provides single sign-on (SSO), user federation, identity brokering, and social login capabilities. This deployment uses Keycloak 26.x with PostgreSQL backend and is configured for high availability with clustering.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Single Sign-On (SSO)</strong>: One login for multiple applications</li>
<li><strong>Identity Brokering</strong>: Connect to external identity providers</li>
<li><strong>User Federation</strong>: Sync users from LDAP or Active Directory</li>
<li><strong>Social Login</strong>: Support for Google, GitHub, Facebook, etc.</li>
<li><strong>Multi-Factor Authentication</strong>: Enhanced security with MFA</li>
<li><strong>High Availability</strong>: Clustered deployment with 2 replicas</li>
<li><strong>Secure Credential Management</strong>: Integration with AWS Secrets Manager</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="components">Components</h3>
<ol>
<li><strong>Deployment</strong>: 2-replica deployment with pod anti-affinity</li>
<li><strong>Services</strong>:
<ul>
<li>Main service on port 8080</li>
<li>Headless service for JGroups clustering</li>
</ul>
</li>
<li><strong>Storage</strong>: PostgreSQL database (postgres-cluster)</li>
<li><strong>ConfigMap</strong>: Environment configuration</li>
<li><strong>External Secrets</strong>:
<ul>
<li>Admin credentials from AWS Secrets Manager</li>
<li>Database credentials from AWS Secrets Manager</li>
</ul>
</li>
<li><strong>Init Container</strong>: Database initialization and user setup</li>
</ol>
<h3 id="resource-requirements">Resource Requirements</h3>
<ul>
<li><strong>Memory</strong>: 1Gi (request), 2Gi (limit) per pod</li>
<li><strong>CPU</strong>: 500m (request), 1000m (limit) per pod</li>
<li><strong>Database</strong>: PostgreSQL with dedicated database and user</li>
</ul>
<h2 id="configuration">Configuration</h2>
<h3 id="environment-settings">Environment Settings</h3>
<table>
  <thead>
      <tr>
          <th>Parameter</th>
          <th>Value</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>KC_HOSTNAME</code></td>
          <td><code>https://auth.landryzetam.net</code></td>
          <td>External hostname</td>
      </tr>
      <tr>
          <td><code>KC_HOSTNAME_STRICT</code></td>
          <td><code>false</code></td>
          <td>Allow backend access</td>
      </tr>
      <tr>
          <td><code>KC_HTTP_ENABLED</code></td>
          <td><code>true</code></td>
          <td>Enable HTTP (behind proxy)</td>
      </tr>
      <tr>
          <td><code>KC_PROXY</code></td>
          <td><code>edge</code></td>
          <td>Running behind edge proxy</td>
      </tr>
      <tr>
          <td><code>KC_PROXY_HEADERS</code></td>
          <td><code>xforwarded</code></td>
          <td>Use X-Forwarded headers</td>
      </tr>
      <tr>
          <td><code>KC_HEALTH_ENABLED</code></td>
          <td><code>true</code></td>
          <td>Enable health endpoints</td>
      </tr>
      <tr>
          <td><code>KC_METRICS_ENABLED</code></td>
          <td><code>true</code></td>
          <td>Enable metrics</td>
      </tr>
      <tr>
          <td><code>KC_CACHE_STACK</code></td>
          <td><code>kubernetes</code></td>
          <td>Use Kubernetes discovery</td>
      </tr>
  </tbody>
</table>
<h3 id="database-configuration">Database Configuration</h3>
<ul>
<li><strong>Type</strong>: PostgreSQL</li>
<li><strong>Host</strong>: <code>postgres-cluster-rw.postgres.svc.cluster.local</code></li>
<li><strong>Port</strong>: 5432</li>
<li><strong>Database</strong>: <code>keycloak</code></li>
<li><strong>Credentials</strong>: Managed via AWS Secrets Manager</li>
</ul>
<h3 id="clustering-configuration">Clustering Configuration</h3>
<p>JGroups clustering is configured for session replication:</p>
<ul>
<li><strong>Discovery</strong>: DNS-based using headless service</li>
<li><strong>Query</strong>: <code>keycloak-headless.keycloak.svc.cluster.local</code></li>
<li><strong>Port</strong>: 7800</li>
</ul>
<h2 id="usage">Usage</h2>
<h3 id="accessing-keycloak">Accessing Keycloak</h3>
<p>External access:</p>
<pre tabindex="0"><code>https://auth.landryzetam.net
</code></pre><p>Internal access:</p>
<pre tabindex="0"><code>http://keycloak.keycloak.svc.cluster.local:8080
</code></pre><h3 id="admin-console">Admin Console</h3>
<ol>
<li>Navigate to <code>https://auth.landryzetam.net/admin</code></li>
<li>Login with admin credentials from AWS Secrets Manager</li>
</ol>
<h3 id="creating-a-realm">Creating a Realm</h3>
<ol>
<li>Login to admin console</li>
<li>Click on the realm dropdown (top-left)</li>
<li>Click &ldquo;Create Realm&rdquo;</li>
<li>Configure realm settings:
<ul>
<li>Name</li>
<li>Display name</li>
<li>Login settings</li>
<li>Token settings</li>
</ul>
</li>
</ol>
<h3 id="adding-applications">Adding Applications</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Example: Register an application</span>
</span></span><span style="display:flex;"><span>1. Select your realm
</span></span><span style="display:flex;"><span>2. Navigate to Clients → Create
</span></span><span style="display:flex;"><span>3. Configure:
</span></span><span style="display:flex;"><span>   - Client ID: your-app-id
</span></span><span style="display:flex;"><span>   - Client Protocol: openid-connect
</span></span><span style="display:flex;"><span>   - Root URL: https://your-app.example.com
</span></span></code></pre></div><h3 id="user-management">User Management</h3>
<h4 id="create-user">Create User</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Via Admin Console</span>
</span></span><span style="display:flex;"><span>1. Select realm
</span></span><span style="display:flex;"><span>2. Navigate to Users → Add user
</span></span><span style="display:flex;"><span>3. Fill in user details
</span></span><span style="display:flex;"><span>4. Set temporary password
</span></span></code></pre></div><h4 id="import-users-from-ldap">Import Users from LDAP</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Configure User Federation</span>
</span></span><span style="display:flex;"><span>1. Navigate to User Federation
</span></span><span style="display:flex;"><span>2. Add provider → LDAP
</span></span><span style="display:flex;"><span>3. Configure connection settings
</span></span><span style="display:flex;"><span>4. Set up attribute mappings
</span></span></code></pre></div><h2 id="operations">Operations</h2>
<h3 id="checking-service-status">Checking Service Status</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Check pods</span>
</span></span><span style="display:flex;"><span>kubectl get pods -n keycloak
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># View logs</span>
</span></span><span style="display:flex;"><span>kubectl logs -n keycloak -l app<span style="color:#f92672">=</span>keycloak
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check cluster status</span>
</span></span><span style="display:flex;"><span>kubectl exec -n keycloak deployment/keycloak -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  curl -s http://localhost:9000/health/ready
</span></span></code></pre></div><h3 id="database-management">Database Management</h3>
<h4 id="check-database-connection">Check Database Connection</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl exec -n keycloak deployment/keycloak -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  env | grep KC_DB
</span></span></code></pre></div><h4 id="database-maintenance">Database Maintenance</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Connect to PostgreSQL</span>
</span></span><span style="display:flex;"><span>kubectl exec -it -n postgres postgres-cluster-rw-0 -- psql -U postgres -d keycloak
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check Keycloak tables</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\d</span>t realm*
</span></span></code></pre></div><h3 id="backup-and-restore">Backup and Restore</h3>
<h4 id="export-realm">Export Realm</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Export specific realm</span>
</span></span><span style="display:flex;"><span>kubectl exec -n keycloak deployment/keycloak -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  /opt/keycloak/bin/kc.sh export <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --file /tmp/realm-export.json <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --realm your-realm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Copy export locally</span>
</span></span><span style="display:flex;"><span>kubectl cp keycloak/keycloak-pod:/tmp/realm-export.json ./realm-backup.json
</span></span></code></pre></div><h4 id="import-realm">Import Realm</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Copy file to pod</span>
</span></span><span style="display:flex;"><span>kubectl cp ./realm-backup.json keycloak/keycloak-pod:/tmp/realm-import.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Import realm</span>
</span></span><span style="display:flex;"><span>kubectl exec -n keycloak deployment/keycloak -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  /opt/keycloak/bin/kc.sh import <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --file /tmp/realm-import.json
</span></span></code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="pod-not-starting">Pod Not Starting</h3>
<ol>
<li><strong>Check init container logs</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs -n keycloak -l app<span style="color:#f92672">=</span>keycloak -c database-init
</span></span></code></pre></div><ol start="2">
<li><strong>Verify AWS credentials</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get secret -n keycloak aws-credentials-env
</span></span></code></pre></div><ol start="3">
<li><strong>Check external secrets</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get externalsecret -n keycloak
</span></span><span style="display:flex;"><span>kubectl describe externalsecret -n keycloak keycloak-admin-credentials
</span></span></code></pre></div><h3 id="authentication-issues">Authentication Issues</h3>
<ol>
<li><strong>Check admin credentials</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get secret -n keycloak keycloak-admin-credentials -o yaml
</span></span></code></pre></div><ol start="2">
<li><strong>Reset admin password</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Connect to pod</span>
</span></span><span style="display:flex;"><span>kubectl exec -it -n keycloak deployment/keycloak -- bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reset password</span>
</span></span><span style="display:flex;"><span>/opt/keycloak/bin/kc.sh start-dev <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --bootstrap-admin-username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --bootstrap-admin-password<span style="color:#f92672">=</span>newpassword
</span></span></code></pre></div><h3 id="clustering-issues">Clustering Issues</h3>
<ol>
<li><strong>Check JGroups discovery</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># View cluster members</span>
</span></span><span style="display:flex;"><span>kubectl exec -n keycloak deployment/keycloak -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  nslookup keycloak-headless.keycloak.svc.cluster.local
</span></span></code></pre></div><ol start="2">
<li><strong>Check JGroups logs</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs -n keycloak -l app<span style="color:#f92672">=</span>keycloak | grep -i jgroups
</span></span></code></pre></div><h3 id="performance-issues">Performance Issues</h3>
<ol>
<li><strong>Monitor resource usage</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl top pods -n keycloak
</span></span></code></pre></div><ol start="2">
<li><strong>Check database performance</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Long-running queries</span>
</span></span><span style="display:flex;"><span>kubectl exec -n postgres postgres-cluster-rw-0 -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  psql -U postgres -d keycloak -c <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#34;SELECT pid, now() - pg_stat_activity.query_start AS duration, query 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   FROM pg_stat_activity 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   WHERE (now() - pg_stat_activity.query_start) &gt; interval &#39;5 minutes&#39;;&#34;</span>
</span></span></code></pre></div><h2 id="security-considerations">Security Considerations</h2>
<h3 id="credential-management">Credential Management</h3>
<ul>
<li>Admin credentials stored in AWS Secrets Manager</li>
<li>Database credentials managed via External Secrets Operator</li>
<li>No hardcoded passwords in configurations</li>
</ul>
<h3 id="network-security">Network Security</h3>
<ul>
<li>TLS termination at ingress</li>
<li>Internal communication over HTTP (secure network)</li>
<li>Consider implementing network policies</li>
</ul>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Regular Updates</strong>: Keep Keycloak version updated</li>
<li><strong>Audit Logging</strong>: Enable and monitor audit logs</li>
<li><strong>Token Rotation</strong>: Configure appropriate token lifetimes</li>
<li><strong>Password Policies</strong>: Enforce strong password requirements</li>
<li><strong>MFA</strong>: Enable multi-factor authentication for admin accounts</li>
</ol>
<h2 id="integration-examples">Integration Examples</h2>
<h3 id="oauth2oidc-client-configuration">OAuth2/OIDC Client Configuration</h3>
<h4 id="spring-boot-application">Spring Boot Application</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">security</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">oauth2</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">client</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">registration</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">keycloak</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">client-id</span>: <span style="color:#ae81ff">your-app</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">client-secret</span>: <span style="color:#ae81ff">${CLIENT_SECRET}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">scope</span>: <span style="color:#ae81ff">openid,profile,email</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">authorization-grant-type</span>: <span style="color:#ae81ff">authorization_code</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">provider</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">keycloak</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">issuer-uri</span>: <span style="color:#ae81ff">https://auth.landryzetam.net/realms/your-realm</span>
</span></span></code></pre></div><h4 id="nodejs-application">Node.js Application</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Keycloak</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;keycloak-connect&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">keycloak</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Keycloak</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">realm</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;your-realm&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;auth-server-url&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;https://auth.landryzetam.net/&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;ssl-required&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;external&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clientId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;your-app&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">secret</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">CLIENT_SECRET</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="service-account-setup">Service Account Setup</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Create service account</span>
</span></span><span style="display:flex;"><span>1. Create client with:
</span></span><span style="display:flex;"><span>   - Access Type: confidential
</span></span><span style="display:flex;"><span>   - Service Accounts Enabled: true
</span></span><span style="display:flex;"><span>2. Note the client secret
</span></span><span style="display:flex;"><span>3. Assign roles to service account
</span></span></code></pre></div><h2 id="monitoring">Monitoring</h2>
<h3 id="key-metrics">Key Metrics</h3>
<ul>
<li>Login success/failure rates</li>
<li>Token issuance rate</li>
<li>Database connection pool usage</li>
<li>Memory and CPU utilization</li>
<li>Response times</li>
</ul>
<h3 id="health-endpoints">Health Endpoints</h3>
<ul>
<li><strong>Readiness</strong>: <code>http://keycloak:9000/health/ready</code></li>
<li><strong>Liveness</strong>: <code>http://keycloak:9000/health/live</code></li>
<li><strong>Metrics</strong>: <code>http://keycloak:9000/metrics</code></li>
</ul>
<h3 id="prometheus-integration">Prometheus Integration</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># ServiceMonitor for Prometheus</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">monitoring.coreos.com/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceMonitor</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">keycloak</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">keycloak</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">keycloak</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">endpoints</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">management</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/metrics</span>
</span></span></code></pre></div><h2 id="maintenance">Maintenance</h2>
<h3 id="version-upgrades">Version Upgrades</h3>
<ol>
<li>
<p><strong>Backup current state</strong>:</p>
<ul>
<li>Export all realms</li>
<li>Backup database</li>
</ul>
</li>
<li>
<p><strong>Test upgrade</strong>:</p>
<ul>
<li>Deploy new version in staging</li>
<li>Verify functionality</li>
</ul>
</li>
<li>
<p><strong>Rolling upgrade</strong>:</p>
<ul>
<li>Update image version</li>
<li>Monitor pod rollout</li>
</ul>
</li>
</ol>
<h3 id="database-maintenance-1">Database Maintenance</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Vacuum database</span>
</span></span><span style="display:flex;"><span>kubectl exec -n postgres postgres-cluster-rw-0 -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  psql -U postgres -d keycloak -c <span style="color:#e6db74">&#34;VACUUM ANALYZE;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check table sizes</span>
</span></span><span style="display:flex;"><span>kubectl exec -n postgres postgres-cluster-rw-0 -- <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  psql -U postgres -d keycloak -c <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#34;SELECT schemaname,tablename,pg_size_pretty(pg_relation_size(schemaname||&#39;.&#39;||tablename)) AS size
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   FROM pg_tables WHERE schemaname=&#39;public&#39; ORDER BY pg_relation_size(schemaname||&#39;.&#39;||tablename) DESC;&#34;</span>
</span></span></code></pre></div><h2 id="future-improvements">Future Improvements</h2>
<ul>
<li><input disabled="" type="checkbox"> Implement automated backup strategy</li>
<li><input disabled="" type="checkbox"> Add Grafana dashboards for monitoring</li>
<li><input disabled="" type="checkbox"> Configure audit logging to external system</li>
<li><input disabled="" type="checkbox"> Implement custom themes</li>
<li><input disabled="" type="checkbox"> Add support for WebAuthn/FIDO2</li>
<li><input disabled="" type="checkbox"> Configure user self-registration workflows</li>
<li><input disabled="" type="checkbox"> Implement automated realm provisioning</li>
<li><input disabled="" type="checkbox"> Add integration with external identity providers</li>
</ul>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
</div>
    <small class="footer_copyright">
        © 2025 .
        
    </small>
</footer>







    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
