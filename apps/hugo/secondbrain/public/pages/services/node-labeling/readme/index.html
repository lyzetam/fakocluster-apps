<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name"> | My New Hugo Site</title>
<meta property="og:title" content=" | My New Hugo Site" />
<meta name="twitter:title" content=" | My New Hugo Site" />
<meta itemprop="name" content=" | My New Hugo Site" />
<meta name="application-name" content=" | My New Hugo Site" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/pages/services/node-labeling/readme/" title="" />






<meta name="generator" content="Hugo 0.148.2">

    
    <meta property="og:url" content="http://localhost:1313/pages/services/node-labeling/readme/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="My New Hugo Site">
  <meta property="og:description" content="Node Labeling - Kubernetes Node Classification Service Overview Node Labeling is an automated Kubernetes job deployed in the Fako cluster that applies strategic labels to cluster nodes. It classifies nodes based on their hardware capabilities, particularly focusing on GPU resources and performance tiers. This service ensures that workloads can be properly scheduled to appropriate nodes using node selectors and affinity rules. The labeling is crucial for GPU workloads, voice pipeline services, and general workload distribution across the heterogeneous cluster.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="pages">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="My New Hugo Site">
  <meta name="twitter:description" content="Node Labeling - Kubernetes Node Classification Service Overview Node Labeling is an automated Kubernetes job deployed in the Fako cluster that applies strategic labels to cluster nodes. It classifies nodes based on their hardware capabilities, particularly focusing on GPU resources and performance tiers. This service ensures that workloads can be properly scheduled to appropriate nodes using node selectors and affinity rules. The labeling is crucial for GPU workloads, voice pipeline services, and general workload distribution across the heterogeneous cluster.">


    

    <link rel="canonical" href="http://localhost:1313/pages/services/node-labeling/readme/">
    <link href="/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        About
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/projects/">
                        Projects
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/secondbrain/">
                        Second Brain
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title"></h1>
                
                
            </header>
            
            <div class="page-content">
                <h1 id="node-labeling---kubernetes-node-classification-service">Node Labeling - Kubernetes Node Classification Service</h1>
<h2 id="overview">Overview</h2>
<p>Node Labeling is an automated Kubernetes job deployed in the Fako cluster that applies strategic labels to cluster nodes. It classifies nodes based on their hardware capabilities, particularly focusing on GPU resources and performance tiers. This service ensures that workloads can be properly scheduled to appropriate nodes using node selectors and affinity rules. The labeling is crucial for GPU workloads, voice pipeline services, and general workload distribution across the heterogeneous cluster.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Automated Node Classification</strong>: Labels nodes based on hardware capabilities</li>
<li><strong>GPU Detection and Labeling</strong>: Comprehensive GPU-related labels</li>
<li><strong>Hardware Tiering</strong>: Classifies nodes into performance tiers</li>
<li><strong>Voice Pipeline Support</strong>: Enables nodes for voice processing</li>
<li><strong>Cleanup Operations</strong>: Removes labels from decommissioned nodes</li>
<li><strong>TTL Management</strong>: Auto-cleanup of completed jobs</li>
<li><strong>Idempotent Operations</strong>: Safe to run multiple times</li>
<li><strong>Summary Reporting</strong>: Shows final labeling state</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="components">Components</h3>
<ol>
<li><strong>Job</strong>: One-time execution Kubernetes job</li>
<li><strong>ServiceAccount</strong>: Node labeling permissions</li>
<li><strong>ClusterRole</strong>: Permission to label nodes</li>
<li><strong>Container</strong>: kubectl image for operations</li>
<li><strong>TTL</strong>: Auto-cleanup after 300 seconds</li>
</ol>
<h3 id="node-categories">Node Categories</h3>
<ol>
<li>
<p><strong>Dual-GPU Nodes</strong> (<code>yeezyai</code>):</p>
<ul>
<li>RTX 5070 + RTX 3050</li>
<li>Full GPU compute capabilities</li>
</ul>
</li>
<li>
<p><strong>High-Performance Nodes</strong>:</p>
<ul>
<li><code>pgbee</code>, <code>pgmac01</code>, <code>pgmac02</code></li>
<li>Voice pipeline enabled</li>
</ul>
</li>
<li>
<p><strong>Standard Nodes</strong>:</p>
<ul>
<li><code>pglenovo01</code>, <code>pglenovo02</code>, <code>thinkpad01</code></li>
<li>General compute workloads</li>
</ul>
</li>
</ol>
<h2 id="configuration">Configuration</h2>
<h3 id="label-schema">Label Schema</h3>
<h4 id="gpu-labels">GPU Labels</h4>
<table>
  <thead>
      <tr>
          <th>Label</th>
          <th>Value</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>nvidia.com/gpu</code></td>
          <td><code>true</code></td>
          <td>NVIDIA GPU present</td>
      </tr>
      <tr>
          <td><code>node-role.kubernetes.io/gpu-worker</code></td>
          <td><code>true</code></td>
          <td>GPU worker role</td>
      </tr>
      <tr>
          <td><code>gpu.nvidia.present</code></td>
          <td><code>true</code></td>
          <td>GPU availability</td>
      </tr>
      <tr>
          <td><code>gpu.count</code></td>
          <td><code>2</code></td>
          <td>Number of GPUs</td>
      </tr>
      <tr>
          <td><code>gpu.rtx5070</code></td>
          <td><code>true</code></td>
          <td>RTX 5070 present</td>
      </tr>
      <tr>
          <td><code>gpu.rtx3050</code></td>
          <td><code>true</code></td>
          <td>RTX 3050 present</td>
      </tr>
      <tr>
          <td><code>accelerator</code></td>
          <td><code>nvidia-gpu</code></td>
          <td>Accelerator type</td>
      </tr>
  </tbody>
</table>
<h4 id="hardware-tiers">Hardware Tiers</h4>
<table>
  <thead>
      <tr>
          <th>Label</th>
          <th>Values</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>hardware.tier</code></td>
          <td><code>dual-gpu</code>, <code>high-performance</code>, <code>standard</code></td>
          <td>Performance classification</td>
      </tr>
      <tr>
          <td><code>node-type</code></td>
          <td><code>gpu-compute</code></td>
          <td>Node purpose</td>
      </tr>
      <tr>
          <td><code>voice-pipeline</code></td>
          <td><code>enabled</code></td>
          <td>Voice processing capability</td>
      </tr>
  </tbody>
</table>
<h2 id="usage">Usage</h2>
<h3 id="running-the-job">Running the Job</h3>
<p>Execute node labeling:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f apps/base/node-labeling/label-nodes-job.yaml
</span></span></code></pre></div><p>Monitor execution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Watch job progress</span>
</span></span><span style="display:flex;"><span>kubectl logs -n node-labeling -l job-name<span style="color:#f92672">=</span>label-nodes-for-voice-pipeline -f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check job status</span>
</span></span><span style="display:flex;"><span>kubectl get job -n node-labeling label-nodes-for-voice-pipeline
</span></span></code></pre></div><h3 id="verifying-labels">Verifying Labels</h3>
<p>Check all node labels:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># View all nodes with key labels</span>
</span></span><span style="display:flex;"><span>kubectl get nodes -L hardware.tier,voice-pipeline,nvidia.com/gpu,gpu.count
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check specific node</span>
</span></span><span style="display:flex;"><span>kubectl describe node yeezyai | grep Labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># List GPU nodes</span>
</span></span><span style="display:flex;"><span>kubectl get nodes -l nvidia.com/gpu<span style="color:#f92672">=</span>true
</span></span></code></pre></div><h3 id="using-labels-for-scheduling">Using Labels for Scheduling</h3>
<h4 id="gpu-workload">GPU Workload</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nvidia.com/gpu</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hardware.tier</span>: <span style="color:#e6db74">&#34;dual-gpu&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nvidia.com/gpu</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">Exists</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">effect</span>: <span style="color:#ae81ff">NoSchedule</span>
</span></span></code></pre></div><h4 id="voice-pipeline-workload">Voice Pipeline Workload</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">voice-pipeline</span>: <span style="color:#e6db74">&#34;enabled&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">hardware.tier</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>: [<span style="color:#e6db74">&#34;high-performance&#34;</span>]
</span></span></code></pre></div><h2 id="operations">Operations</h2>
<h3 id="manual-labeling">Manual Labeling</h3>
<p>Add custom labels:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Add label</span>
</span></span><span style="display:flex;"><span>kubectl label nodes &lt;node-name&gt; custom-label<span style="color:#f92672">=</span>value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Remove label</span>
</span></span><span style="display:flex;"><span>kubectl label nodes &lt;node-name&gt; custom-label-
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Update label</span>
</span></span><span style="display:flex;"><span>kubectl label nodes &lt;node-name&gt; custom-label<span style="color:#f92672">=</span>new-value --overwrite
</span></span></code></pre></div><h3 id="cleanup-old-jobs">Cleanup Old Jobs</h3>
<p>Remove completed jobs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># List old jobs</span>
</span></span><span style="display:flex;"><span>kubectl get jobs -n node-labeling
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Delete specific job</span>
</span></span><span style="display:flex;"><span>kubectl delete job label-nodes-for-voice-pipeline -n node-labeling
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Delete all completed jobs</span>
</span></span><span style="display:flex;"><span>kubectl delete jobs -n node-labeling --field-selector status.successful<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h3 id="adding-new-nodes">Adding New Nodes</h3>
<p>Update the job to include new nodes:</p>
<ol>
<li>Edit <code>label-nodes-job.yaml</code></li>
<li>Add node to appropriate section</li>
<li>Apply the updated job</li>
</ol>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Add to high-performance section</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> node in pgbee pgmac01 pgmac02 new-node; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ... labeling logic</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="job-failures">Job Failures</h3>
<ol>
<li><strong>Check job status</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe job -n node-labeling label-nodes-for-voice-pipeline
</span></span></code></pre></div><ol start="2">
<li><strong>View pod logs</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs -n node-labeling -l job-name<span style="color:#f92672">=</span>label-nodes-for-voice-pipeline
</span></span></code></pre></div><ol start="3">
<li><strong>Common issues</strong>:
<ul>
<li>Node not found</li>
<li>Insufficient permissions</li>
<li>Label conflicts</li>
</ul>
</li>
</ol>
<h3 id="permission-issues">Permission Issues</h3>
<ol>
<li><strong>Verify RBAC</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get clusterrole node-labeler -o yaml
</span></span><span style="display:flex;"><span>kubectl get clusterrolebinding node-labeler -o yaml
</span></span></code></pre></div><ol start="2">
<li><strong>Test permissions</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl auth can-i update nodes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --as<span style="color:#f92672">=</span>system:serviceaccount:node-labeling:node-labeler
</span></span></code></pre></div><h3 id="label-conflicts">Label Conflicts</h3>
<ol>
<li><strong>Check existing labels</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get node &lt;node-name&gt; -o yaml | grep -A20 labels:
</span></span></code></pre></div><ol start="2">
<li><strong>Force overwrite</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl label nodes &lt;node-name&gt; label-key<span style="color:#f92672">=</span>value --overwrite
</span></span></code></pre></div><h2 id="label-management">Label Management</h2>
<h3 id="label-conventions">Label Conventions</h3>
<p>Follow naming standards:</p>
<ul>
<li>Use lowercase</li>
<li>Separate words with hyphens</li>
<li>Use namespaced labels for custom domains</li>
<li>Keep labels concise but descriptive</li>
</ul>
<h3 id="reserved-labels">Reserved Labels</h3>
<p>Avoid modifying:</p>
<ul>
<li><code>kubernetes.io/*</code> - System labels</li>
<li><code>node.kubernetes.io/*</code> - Node properties</li>
<li><code>feature.node.kubernetes.io/*</code> - Feature discovery</li>
</ul>
<h3 id="custom-labels">Custom Labels</h3>
<p>Add project-specific labels:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Example custom labels</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">workload.myapp/database</span>: <span style="color:#e6db74">&#34;supported&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">environment.myapp/type</span>: <span style="color:#e6db74">&#34;production&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">team.owner</span>: <span style="color:#e6db74">&#34;platform&#34;</span>
</span></span></code></pre></div><h2 id="security-considerations">Security Considerations</h2>
<h3 id="rbac-permissions">RBAC Permissions</h3>
<ul>
<li>Limited to node labeling operations</li>
<li>Cannot modify node specs</li>
<li>No access to workloads or secrets</li>
</ul>
<h3 id="audit-trail">Audit Trail</h3>
<ul>
<li>All label changes logged in Kubernetes audit</li>
<li>Job execution history preserved</li>
<li>TTL ensures cleanup</li>
</ul>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Review changes</strong>: Check label modifications</li>
<li><strong>Test first</strong>: Try on non-production nodes</li>
<li><strong>Document labels</strong>: Maintain label documentation</li>
<li><strong>Version control</strong>: Track job changes in Git</li>
<li><strong>Monitor usage</strong>: Audit label usage regularly</li>
</ol>
<h2 id="integration-examples">Integration Examples</h2>
<h3 id="with-node-feature-discovery">With Node Feature Discovery</h3>
<p>Combine with NFD labels:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Use both custom and NFD labels</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hardware.tier</span>: <span style="color:#e6db74">&#34;high-performance&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">feature.node.kubernetes.io/cpu-cpuid.AVX512</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span></code></pre></div><h3 id="with-cluster-autoscaler">With Cluster Autoscaler</h3>
<p>Configure scaling groups:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Label for autoscaling groups</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cluster-autoscaler.kubernetes.io/gpu-type</span>: <span style="color:#e6db74">&#34;rtx5070&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cluster-autoscaler.kubernetes.io/scale-down-disabled</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span></code></pre></div><h3 id="with-monitoring">With Monitoring</h3>
<p>Track labeled nodes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Prometheus query</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kube_node_labels{label_hardware_tier=&#34;dual-gpu&#34;}</span>
</span></span></code></pre></div><h2 id="monitoring">Monitoring</h2>
<h3 id="key-metrics">Key Metrics</h3>
<ul>
<li>Node count by tier</li>
<li>Label drift detection</li>
<li>Job execution success rate</li>
<li>Time to complete labeling</li>
</ul>
<h3 id="alerts">Alerts</h3>
<p>Configure alerts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Alert on missing labels</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">alert</span>: <span style="color:#ae81ff">NodeMissingLabels</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expr</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kube_node_info unless on(node) 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kube_node_labels{label_hardware_tier=~&#34;.+&#34;}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">summary</span>: <span style="color:#e6db74">&#34;Node {{ $labels.node }} missing tier label&#34;</span>
</span></span></code></pre></div><h2 id="maintenance">Maintenance</h2>
<h3 id="regular-tasks">Regular Tasks</h3>
<ol>
<li>
<p><strong>Weekly</strong>:</p>
<ul>
<li>Verify all nodes labeled</li>
<li>Check for new nodes</li>
<li>Review label usage</li>
</ul>
</li>
<li>
<p><strong>Monthly</strong>:</p>
<ul>
<li>Audit label schema</li>
<li>Clean unused labels</li>
<li>Update documentation</li>
</ul>
</li>
<li>
<p><strong>Quarterly</strong>:</p>
<ul>
<li>Review labeling strategy</li>
<li>Plan label migrations</li>
<li>Update job configuration</li>
</ul>
</li>
</ol>
<h3 id="label-evolution">Label Evolution</h3>
<p>Handle label changes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># migrate-labels.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rename label across all nodes</span>
</span></span><span style="display:flex;"><span>OLD_LABEL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;old-key&#34;</span>
</span></span><span style="display:flex;"><span>NEW_LABEL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;new-key&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> node in <span style="color:#66d9ef">$(</span>kubectl get nodes -o name<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  VALUE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get $node -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.metadata.labels.</span>$OLD_LABEL<span style="color:#e6db74">}&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span>$VALUE<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    kubectl label $node $NEW_LABEL<span style="color:#f92672">=</span>$VALUE
</span></span><span style="display:flex;"><span>    kubectl label $node $OLD_LABEL-
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="dynamic-labeling">Dynamic Labeling</h3>
<p>Add conditional logic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Label based on node resources</span>
</span></span><span style="display:flex;"><span>CPU_COUNT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get node $node -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.status.capacity.cpu}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $CPU_COUNT -ge <span style="color:#ae81ff">16</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  apply_label $node <span style="color:#e6db74">&#34;cpu.class=high&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><h3 id="external-data-sources">External Data Sources</h3>
<p>Integrate with inventory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Pull labels from external source</span>
</span></span><span style="display:flex;"><span>LABELS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s https://inventory.internal/api/nodes/$node/labels<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> label in $LABELS; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  apply_label $node <span style="color:#e6db74">&#34;</span>$label<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h3 id="validation">Validation</h3>
<p>Add label validation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Validate required labels exist</span>
</span></span><span style="display:flex;"><span>REQUIRED_LABELS<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;hardware.tier&#34;</span> <span style="color:#e6db74">&#34;node-type&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> label in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REQUIRED_LABELS[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ! kubectl get node $node -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.metadata.labels.</span>$label<span style="color:#e6db74">}&#34;</span> | grep -q .; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;ERROR: Missing required label </span>$label<span style="color:#e6db74"> on </span>$node<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h2 id="future-improvements">Future Improvements</h2>
<ul>
<li><input disabled="" type="checkbox"> Implement continuous labeling daemon</li>
<li><input disabled="" type="checkbox"> Add webhook for automatic new node labeling</li>
<li><input disabled="" type="checkbox"> Create label governance policies</li>
<li><input disabled="" type="checkbox"> Add label validation admission controller</li>
<li><input disabled="" type="checkbox"> Implement label-based cost allocation</li>
<li><input disabled="" type="checkbox"> Create label dependency management</li>
<li><input disabled="" type="checkbox"> Add automatic GPU model detection</li>
<li><input disabled="" type="checkbox"> Implement label history tracking</li>
<li><input disabled="" type="checkbox"> Create label migration tools</li>
<li><input disabled="" type="checkbox"> Add integration with hardware inventory system</li>
</ul>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
</div>
    <small class="footer_copyright">
        © 2025 .
        
    </small>
</footer>







    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
